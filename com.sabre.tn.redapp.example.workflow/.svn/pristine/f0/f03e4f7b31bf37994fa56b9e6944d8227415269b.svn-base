package com.sabre.tn.redapp.example.workflow.listeners;

import org.eclipse.jface.preference.IPreferenceStore;

import com.sabre.edge.cf.emu.data.EmulatorCommand;
import com.sabre.edge.cf.emu.data.requests.EmulatorCommandRequest;
import com.sabre.edge.cf.emu.data.responses.EmulatorCommandResponse;
import com.sabre.edge.cf.model.IEvent;
import com.sabre.edge.cf.model.IEventListener;
import com.sabre.edge.cf.model.element.ServiceContext;
import com.sabre.tn.redapp.example.workflow.Activator;
import com.sabre.tn.redapp.example.workflow.preferences.PreferenceConstants;
import com.sabre.tn.redapp.example.workflow.uiparts.OpenThingsHelper;

public class AvailabilityListener implements IEventListener {

	@Override
	public void handleEvent(IEvent evt) {
		IPreferenceStore st = Activator.getDefault().getPreferenceStore();
		
		
		boolean shouldListenAvailability=st.getBoolean(PreferenceConstants.P_LISTEN_AVAIL);

		
		if(shouldListenAvailability){

			ServiceContext sc = (ServiceContext)evt.getContext();
			EmulatorCommandRequest cmdRQ = (EmulatorCommandRequest) sc.getRequest();
			EmulatorCommandResponse cmdRS = (EmulatorCommandResponse) sc.getResponse();
			EmulatorCommand cmd = cmdRQ.getEmulatorCommand();
			String cmdTyped = cmd.getCommand();
			String cmdResp = cmdRS.getEmulatorResponse()!=null?cmdRS.getEmulatorResponse().getResponse():"";
			
			
			if(cmdTyped!=null && !cmdTyped.isEmpty()){
				
				if(shouldListenAvailability && cmdTyped.startsWith("1")){
					//availability command, show WebKit View
					OpenThingsHelper.showAdvWebView("file:///C:/TTXSB/workspace/com.sabre.tn.redapp.example.workflow/resources/AvAssistant.html", null);
					
					
				}

			}
			
		}

	}

}
